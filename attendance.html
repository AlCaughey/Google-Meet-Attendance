<html>
	<head>
	<script type="text/javascript" >
		let startTime='9:20'
		let endTime='10:20'
		let classList=[%%Class-List%%]
		let _arrivalTimes=[%%Class-List%%]
	</script>
	<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
	<script type="text/javascript" src="https://code.jquery.com/ui/1.11.3/jquery-ui.min.js"></script>
	<script type='text/javascript'>
	
		// pad with a leading zero (for dates & time)
		function twod(v,n){
			if (!n) n=2
			return ('00000'+Number(v)).slice(-n)
		}

		$('document').ready(function(){
		
			let d=$('<div/>')
			d.attr('id','student-row-header').attr('data-student-name', 'Names').addClass('student-row').addClass('not-present')
			let s=$('<span/>').text('Names').addClass('student-name')
			s.appendTo(d)
			
			let st=startTime.split(':'), et=endTime.split(':')
			let meetDuration=(et[0]*60+et[1]*1)-(st[0]*60+st[1]*1)
			let hr=st[0],min=st[1]*1
			for (let nn=0; nn<meetDuration; nn++){
				let s=$('<span/>').addClass('i-'+hr+'-'+twod(min) ).addClass('cc').attr('title', hr+':'+twod(min))
				s.appendTo(d)
				min=(min+1)%60
				if(min===0) hr++
			}
			d.appendTo('#main-table')
			$.each(classList, function( index, value ) {
				let d=$('#student-row-header').clone(true,true).removeAttr('id')
				let lcn=value.toLowerCase()
				d.attr('data-student-name', lcn).find('.student-name').text(lcn)
				d.appendTo('#main-table')
			});
			$.each(_arrivalTimes, function( name, checks ) {
				let wr=$('[data-student-name="'+name.toLowerCase()+'"]')
				$(wr).removeClass('not-present')
				$.each(checks.checks, function(chkt,b){
					let ct='i-'+chkt.replace(':','-')
					$(wr).find('.'+ct).addClass('present')
				})
			});
        });
	</script>
	<style>
		.cc:nth-child(5n+1) { border-right: 1px solid #aaa;	}
		.student-row{ display:flex; }
		.student-row.not-present { background-color: #fcc; }
		.student-row:nth-child(5n+1) { border-bottom: 1px solid #aaa; }
		.student-name { border-right: 1px solid #aaa; display: inline-block; min-width: 100px; text-overflow: ellipsis; overflow: hidden; white-space: nowrap; width: 128px; text-transform: capitalize; }
		.student-name::before { content: "âœ” "; color: #3b7703; }
		.not-present .student-name::before { content: " "; padding-right: 15px; }		
		.cc{ flex:1; }
		.present { background: #3b7703; }
		#student-row-header { background: #777; color: white; font-weight: bold; border-bottom: 3px double #333; }		
	</style>
	</head>
	<body>
	<div id='attendance-report'><h1>Attendance Report</h1>
	<p>Class: <span id='class-name'></span>Date: <span id='class-date'></span> Start Time: <span id='class-start'></span></p></div>
	<div id='main-table'>
	</div>
	</body>
	<footer>
	<p>Generated by the <a href='https://chrome.google.com/webstore/detail/fkdjflnaggakjamjkmimcofefhppfljd/publish-accepted?authuser=0&hl=en' target='_blank'>Google Meet Attendance extension</a></p>
	</footer>
</html>